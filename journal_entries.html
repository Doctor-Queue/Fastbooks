<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Journal Entires</title>

<!-- Updated upstream, adding bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="  crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"  crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="WebNavBar.css" />

</head>
<body>
<section>

<!-- Following will add the beige band on top with "Welcome Admin User" text -->
<!-- Navbar with logo and buttons-->
<nav>
    <div class="logo-container">
      <a href="index.html">
        <img src="app_logo.png" id="Logo"></a>
    </div>
    <div class="welcome-txt">
        <h2>  Journal Entries </h2>
    </div>
    

   <!-- Added an empty profile pic with the option of switching to the pre-set pic (SHOULD be changed!)-->
   <img src="profile.jpeg" class="profile" type="button" id="profile" data-bs-toggle="dropdown"><span class="caret"></span>

<!-- Page Links under nav -->
 
<div class="username">
        <!-- To load username when page is loaded -->
        <script>
            var showingUserFirstName = document.getElementById('userFirstName');
            document.write(showingUserFirstName);
        </script>
    
</div>
</nav>

<div>
    <div class="nav-links">
        <li><a href="#">Placeholder</a></li>
        <li><a href="#">Self Help</a></li>
        <li><a href="#">Contact Us</a></li>
        <li><a href="Login.html">Sign in</a></li>
    </div>
</div>
<!-- Sidenav Menu from W3 -->
<!-- https://www.w3schools.com/howto/howto_js_sidenav.asp -->
<div id="mySidenav" class="sidenav" style="white-space: nowrap;">
<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
<a href="#" onclick="location.href='index.html'">Home</a>
<a href="#">Email</a>
<a href="#" onclick="location.href='view_accounts.html'">Chart of Accounts</a>
<a href="#" onclick="location.href='journal_entries.html'">Journal</a>
</div>

<!-- Use any element to open the sidenav -->
<span onclick="openNav()"><button id="sideBarBtn">â‰¡</button></span>

<br>
<br>

<div class="container mt-3">
    <h3 id="approvedEntriesTitle" style="text-align: center; position:relative; top:43px;">Approved Entries</h3>
    <p><style> #searchText{width: 200px; position: relative; border: 1px solid #ccc; display:inline;}</style>
    <style> #addJournalBtn{ position: relative; border: 2px solid #ccc; background-color: rgb(214, 245, 228); float: right; display:inline;}</style>
    <style>  #search{text-align: left;}</style>
    <label for="searchText" id="search">Search:</label>
    <input name="searchText" id="searchText" type="text" placeholder="Search">
    <button id="addJournalBtn" onclick="location.href='add_journal_entries.html'">+ Add Journal Entry</button></p>

    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
        <tr class="table-success">
            <th class="th-sm">Entry ID</th>
            <th class="th-sm">Date Submitted</th>
            <th class="th-sm">Submitted By</th>
            <th class="th-sm">Approved By</th>
            <th class="th-sm">Account Name</th>
            <th class="th-sm">Description</th>
            <th class="th-sm">Accounts Debited</th>
            <th class="th-sm">Accounts Credited</th>
            <th class="th-sm">Attachment</th>
        </tr>
        </thead>
        <tbody id="approved-journal-list"></tbody>
    </table>
</div>

<br>

<div class="container mt-3">
    <h3 id="approvedEntriesTitle" style="text-align: center; position:relative;">Pending Entries</h3>

    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
        <tr class="table-warning">
            <th class="th-sm">Entry ID</th>
            <th class="th-sm">Date Submitted</th>
            <th class="th-sm">Submitted By</th>
            <th class="th-sm">Approved By</th>
            <th class="th-sm">Account Name</th>
            <th class="th-sm">Description</th>
            <th class="th-sm">Accounts Debited</th>
            <th class="th-sm">Accounts Credited</th>
            <th class="th-sm">Attachment</th>
        </tr>
        </thead>
        <tbody id="pending-journal-list"></tbody>
    </table>

</div>

<br>

<div class="container mt-3">
    <h3 id="approvedEntriesTitle" style="text-align: center; position:relative;">Rejected Entries</h3>

    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
        <tr class="table-danger">
            <th class="th-sm">Entry ID</th>
            <th class="th-sm">Date Submitted</th>
            <th class="th-sm">Submitted By</th>
            <th class="th-sm">Approved By</th>
            <th class="th-sm">Account Name</th>
            <th class="th-sm">Description</th>
            <th class="th-sm">Accounts Debited</th>
            <th class="th-sm">Accounts Credited</th>
            <th class="th-sm">Attachment</th>
        </tr>
        </thead>
        <tbody id="rejected-journal-list"></tbody>
    </table>
</div>

    <script>
        /* Set the width of the side navigation to 250px */
function openNav() {
    document.getElementById("mySidenav").style.width = "250px";
}

/* Set the width of the side navigation to 0 */
function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}
</script>  


</section>

<!-- Footer -->
<footer class="footer">
    <h1>Contact Us!</h1>
    <ul> 
        <a href="#">PlaceHolder</a>
        <a href="#">PlaceHolder</a>
        <a href="#">PlaceHolder</a>
        
    </ul>
   
</footer>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import { getFirestore, collection, getDoc, getDocs, onSnapshot, deleteDoc, 
        addDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // ********** Alexander Day's Database **********
    const firebaseConfig = {
      apiKey: "AIzaSyAswcBVoFfQx746ZSArJw6jZRqfa3ZmBbI",
      authDomain: "swe-4713-application-domain.firebaseapp.com",
      projectId: "swe-4713-application-domain",
      storageBucket: "swe-4713-application-domain.appspot.com",
      messagingSenderId: "210297298562",
      appId: "1:210297298562:web:815b3cc913460d968b5e9b"
    };
  
    // Initialize Cloud Firestore
    const app = initializeApp(firebaseConfig);

    // Initialize Cloud Firestore and get a reference to the service
    const db = getFirestore(app);

    //collection ref
    const colRefApproved = collection(db, 'ApprovedJournalEntries');
    const colRefPending = collection(db, 'PendingJournalEntries');


    // Adds 'A' record to the table. This is paramount in setting it up.
    var tbody = document.getElementById("approved-journal-list");
    var tbody2 = document.getElementById("pending-journal-list");
    var tbody3 = document.getElementById("rejected-journal-list");
    
    function AddItemToApprovedTable(EntryID,DateSubmitted,SubmittedBy,ApprovedBy,
    AccountName,Description,AccountsDebited,AccountsCredited,Attachment) {

        let trow = document.createElement('tr'); //represents the tables rows
        let td1 = document.createElement('td'); //represents the tables columns (or cells as there called)
        let td2 = document.createElement('td');
        let td3 = document.createElement('td');
        let td4 = document.createElement('td');
        let td5 = document.createElement('td');
        let td6 = document.createElement('td');
        let td7 = document.createElement('td');
        let td8 = document.createElement('td');
        let td9 = document.createElement('td');

        td1.innerHTML = EntryID;
        td2.innerHTML = DateSubmitted;
        td3.innerHTML = SubmittedBy;
        td4.innerHTML = ApprovedBy;
        td5.innerHTML = AccountName;
        td6.innerHTML = Description;
        td7.innerHTML = AccountsDebited;
        td8.innerHTML = AccountsCredited;
        td9.innerHTML = Attachment;
    

        //adds the table cells to the table row
        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);
        trow.appendChild(td6);
        trow.appendChild(td7);
        trow.appendChild(td8);
        trow.appendChild(td9);

        tbody.appendChild(trow);

    }

    //Adds the rest or the records to the table.
    function AddAllItemsToApprovedTable(ApprovedJournalEntries) {
        tbody.innerHTML = "";
        ApprovedJournalEntries.forEach(element => {
            AddItemToApprovedTable(element.EntryID, element.DateSubmitted, element.SubmittedBy, 
            element.ApprovedBy, element.AccountName, element.Description, element.AccountsDebited, 
            element.AccountsCredited, element.Attachment);
        });
    }

    //gets all data from firestore. Now upgraded to update in realtime without refreshing the page.
    async function GetAllApprovedJournalDataRealtime() {
        const dbRefApproved = collection(db, "ApprovedJournalEntries");

        onSnapshot(dbRefApproved,(querySnapshot) => {
            var approvedJournalEntries = [];

            querySnapshot.forEach(doc => {
                approvedJournalEntries.push({...doc.data(), id: doc.id});
            });
            AddAllItemsToApprovedTable(approvedJournalEntries);
        })
        


    }

    //shows table upon loading up the page.
    window.onload = GetAllApprovedJournalDataRealtime;

    

    function AddItemToPendingTable(EntryID,DateSubmitted,SubmittedBy,ApprovedBy,
    AccountName,Description,AccountsDebited,AccountsCredited,Attachment) {

        let tPendingrow = document.createElement('tr'); //represents the tables rows
        let tdPending1 = document.createElement('td'); //represents the tables columns (or cells as there called)
        let tdPending2 = document.createElement('td');
        let tdPending3 = document.createElement('td');
        let tdPending4 = document.createElement('td');
        let tdPending5 = document.createElement('td');
        let tdPending6 = document.createElement('td');
        let tdPending7 = document.createElement('td');
        let tdPending8 = document.createElement('td');
        let tdPending9 = document.createElement('td');

        tdPending1.innerHTML = EntryID;
        tdPending2.innerHTML = DateSubmitted;
        tdPending3.innerHTML = SubmittedBy;
        tdPending4.innerHTML = ApprovedBy;
        tdPending5.innerHTML = AccountName;
        tdPending6.innerHTML = Description;
        tdPending7.innerHTML = AccountsDebited;
        tdPending8.innerHTML = AccountsCredited;
        tdPending9.innerHTML = Attachment;
    

        //adds the table cells to the table row
        tPendingrow.appendChild(tdPending1);
        tPendingrow.appendChild(tdPending2);
        tPendingrow.appendChild(tdPending3);
        tPendingrow.appendChild(tdPending4);
        tPendingrow.appendChild(tdPending5);
        tPendingrow.appendChild(tdPending6);
        tPendingrow.appendChild(tdPending7);
        tPendingrow.appendChild(tdPending8);
        tPendingrow.appendChild(tdPending9);

        tbody2.appendChild(tPendingrow);

     }

    //Adds the rest or the records to the table.
    function AddAllItemsToPendingTable(PendingJournalEntries) {
        tbody2.innerHTML = "";
        PendingJournalEntries.forEach(element => {
            AddItemToPendingTable(element.EntryID, element.DateSubmitted, element.SubmittedBy, 
            element.ApprovedBy, element.AccountName, element.Description, element.AccountsDebited, 
            element.AccountsCredited, element.Attachment);
        });
    }

    //gets all data from firestore. Now upgraded to update in realtime without refreshing the page.
    async function GetAllPendingJournalDataRealtime() {
        const dbRefPending = collection(db, "PendingJournalEntries");

        onSnapshot(dbRefPending,(querySnapshot) => {
            var pendingJournalEntries = [];

            querySnapshot.forEach(doc => {
                pendingJournalEntries.push({...doc.data(), id: doc.id});
            });
            AddAllItemsToPendingTable(pendingJournalEntries);
        })
        


    }

    //shows table upon loading up the page.
    window.onload = GetAllPendingJournalDataRealtime;



    onSnapshot(colRefPending, (snapshot) => {
        let users = []
        snapshot.docs.forEach((doc) => {
            users.push({ ...doc.data(), id: doc.id });
        });
        console.log(users);
       })

       onSnapshot(colRefApproved, (snapshot) => {
        let users = []
        snapshot.docs.forEach((doc) => {
            users.push({ ...doc.data(), id: doc.id });
        });
        console.log(users);
       })

</script>
</body>
</html>