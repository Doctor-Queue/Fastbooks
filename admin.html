<!-- THIS IS ADMIN DASHBOARD -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin</title>

<!-- Updated upstream, adding bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="  crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"  crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="WebNavBar.css" />

</head>
<body>
<style>
     .Band{
    background-color: #f5f5dc;
    padding: 4px ;
}
     .Logo {
    display: block;
    width: 10%;
    margin: 0 15px 0 0;
    float:left;
    clip-path: circle();
}
     .tab1{
    display: inline-block;
    margin-left: 10px;
}
     .content{
    background: #f5f5dc;
    max-width: 960px;
    margin: 30px auto;
    padding:  20px 30px;
    border-radius: 10px 120px 10px 10px;
    box-shadow: 1px 3px 5px rgba(0,0,0,0.1)
}
</style>

<!-- Following section takes acre of top nav bar-->
<section>
<!-- Following will add the beige band on top with "Welcome Admin User" text -->
       <div class="Band">
        <h2> <font size="+1.5">  <center>  Welcome Admin! </center>  </font></h2>
        </div>

    <img src="app_logo.png" width="10%" class="Logo">

    <center>
    <form>
            <span style="padding:10px; float:right;">
            <!--  tabs between options-->
            <span class="tab1"> </span>
            <b> <button type="button" class="btn" > Settings </button>
                    <!--  tabs between options-->
                    <span class="tab1"> </span>
                <button type="button" class="btn"> Notifications </button>
                    <!--  tabs between options-->
                    <span class="tab1"> </span>
                <!--Sign In  -->
                <button type="button" class="btn" onclick="location.href='Login.html'"> Login  </button>
                    <!--  tabs between options-->
                    <span class="tab1"> </span>
            </b>

        </span>
        </form>
    </center>
            <div class="content">
                <ul id="admin-list"></ul>
            </div>

</section>



<!-- 
REQUIREMENTS 
Add, View, Edit, or Deactivate accounts. You can ask the
administrator to select which service he wants before displaying the
appropriate user interface where he can perform the functionality.
When an account is added, you must store in the database at least the
following required information using a user interface designed to allow
entering or modifying the information:


-->

<button id="addUser" onclick="location.href='add_user.html'"> Add User</button>
<button id="viewUser"> View User</button>
<button id="editUser"> Edit User</button>
<button id="changeStatus"> Change User Status</button>


<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // ********** Alexander Day's Database **********
    const firebaseConfig = {
      apiKey: "AIzaSyAswcBVoFfQx746ZSArJw6jZRqfa3ZmBbI",
      authDomain: "swe-4713-application-domain.firebaseapp.com",
      projectId: "swe-4713-application-domain",
      storageBucket: "swe-4713-application-domain.appspot.com",
      messagingSenderId: "210297298562",
      appId: "1:210297298562:web:815b3cc913460d968b5e9b"
    };
  
    const app = initializeApp(firebaseConfig);

    // Initialize Cloud Firestore and get a reference to the service
    const db = getFirestore(app);

    //collection ref
    const colRef = collection(db, 'Users');
  

    // Adds 'A' record to the table. This is paramount in setting it up.
    var userNo = 0;
    var tbody = document.getElementById('admin-list');

 

    function AddItemToTable(FirstName,LastName,Email,Address,
    DateOfBirth,Password,SecurityQuestion,SecurityAnswer) {
        let trow = document.createElement('tr'); //represents the tables rows
        let td1 = document.createElement('td'); //represents the tables columns (or cells as there called)
        let td2 = document.createElement('td');
        let td3 = document.createElement('td');
        let td4 = document.createElement('td');
        let td5 = document.createElement('td');
        let td6 = document.createElement('td');
        let td7 = document.createElement('td');
        let td8 = document.createElement('td');
        let td9 = document.createElement('td');

        td1.innerHTML = ++userNo;  //if you want the row numbering gone then remove or slash this part of the code.
        td2.innerHTML = FirstName;
        td3.innerHTML = LastName;
        td4.innerHTML = Email;
        td5.innerHTML = Address;
        td6.innerHTML = DateOfBirth;
        td7.innerHTML = Password;
        td8.innerHTML = SecurityQuestion;
        td9.innerHTML = SecurityAnswer;

        //adds the table cells to the table row
        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);
        trow.appendChild(td6);
        trow.appendChild(td7);
        trow.appendChild(td8);
        trow.appendChild(td9);

        tbody.appendChild(trow);
    }

    //Adds the rest or the records to the table.
    function AddAllItemsToTable(Users) {
        userNo = 0;
        tbody.innerHTML = "";
        Users.forEach(element => {
            AddItemToTable(element.FirstName, element.LastName, element.Email, 
            element.Address, element.DateOfBirth, element.Password, 
            element.SecurityQuestion, element.SecurityAnswer);
        });
    }

    //gets all data from firestore. Now upgraded to update in realtime without refreshing the page.
    async function GetAllDataRealtime() {
        const dbRef = collection(db, "Users");

        onSnapshot(dbRef,(querySnapshot) => {
            var users = [];

            querySnapshot.forEach(doc => {
                users.push({...doc.data(), id: doc.id});
            });
            AddAllItemsToTable(users);
        })
        


    }

    //shows table upon loading up the page.
    window.onload = GetAllDataRealtime;


    //real time collection data. simply checks and reuploads any changes instantly. Shows on console only.
    onSnapshot(colRef, (snapshot) => {
        let users = []
        snapshot.docs.forEach((doc) => {
            users.push({ ...doc.data(), id: doc.id });
        });
        console.log(users);
       })
  </script>  
</body>
</html>